---
title: "DS421 Summer 2019 R Markdown Document"
author: "Katherine Rose Wolf"
date: "August 4, 2019"
output: html_document
---


```{r load libraries}

library(tidyverse)

```

```{r create file structure}

# create raw data file
if(!dir.exists("raw_data")) {
  dir.create("raw_data")
}

if(!dir.exists("intermediate_data")) {
  dir.create("intermediate_data")
}

```


```{r download, read, and save school addresses}

# download school addresses
download.file(
  url = "https://www.cde.ca.gov/schooldirectory/report?rid=dl1&tp=txt", 
  destfile = 
    file.path(
      "raw_data", 
      "public_school_directory.rdata"
    )
    
)

# read school addresses into 
public_school_directory <-
    read_delim(file =
                 file.path(
                   "raw_data", 
                   "public_school_directory.rdata"
                 ),
               delim = "\t"
               )

# save school addresses
save(
  public_school_directory, 
  file = 
    file.path(
      "intermediate_data", 
      "public_school_directory.rdata"
    )
)

```


```{r download school enrollment data}

# school enrollment data by racial/ethnic designation, gender, and grade

# make school enrollment raw downloader function
school_enrollment_raw_downloader <-
  function(start_year_numeric){
    end_year_chr <- 
      as.character(start_year_numeric + 1) %>%  # add 1 to the start year
      substr(3, 4)  # get only the last two digits
    
    start_year_chr <- 
      as.character(start_year_numeric)  # convert start year to numeric
    
    url_file <- 
      str_c("http://dq.cde.ca.gov/dataquest/dlfile/dlfile.aspx?cLevel=School&cYear=", 
            start_year_chr, 
            "-", 
            end_year_chr, 
            "&cCat=Enrollment&cPage=filesenr.asp")
    
    download.file(
      url = url_file, 
      destfile = 
        file.path(
          "raw_data", 
          str_c("school_enrollment_", 
                start_year_chr,
                "_", 
                end_year_chr, 
                "_raw.txt")
        )
    )
  }

# make vector of starting years 2009-2018
start_years <- 
  seq(
    from = 2009,
    to = 2018, 
    by = 1
  )

# download all the school files at once
map(
  .f = school_enrollment_raw_downloader, 
  .x = start_years
)

# read them all into r from tab-delimited files





```


    
```{r read school primary short enrollment data files}

# make school primary short data file downloader function
school_primary_short_enrollment_raw_downloader <-
  function(start_year_numeric){
    end_year_chr <- 
      as.character(start_year_numeric + 1) %>%  # add 1 to the start year
      substr(3, 4)  # get only the last two digits
    
    start_year_chr <- 
      as.character(start_year_numeric) %>%   # convert start year to numeric
      substr(3, 4)  # get only the last two digits
    url_file <- 
      str_c(
        "http://dq.cde.ca.gov/dataquest/dlfile/dlfile.aspx?cLevel=School&cYear=", 
        start_year_chr, 
        end_year_chr, 
        "&cCat=ShortTermEnrl&cPage=filesenrps.asp"
        )
            download.file(
      url = url_file, 
      destfile = 
        file.path(
          "raw_data", 
          str_c("school_primary_short_enrollment_", 
                start_year_chr,
                "_", 
                end_year_chr, 
                "_raw.txt")
        )
    )
  }

# make vector of starting years 2009-2018
start_years <- 
  seq(
    from = 2009,
    to = 2018, 
    by = 1
  )

# download all the school files at once
map(
  .f = school_primary_short_enrollment_raw_downloader, 
  .x = start_years
)

# read them all into r from tab-delimited files


```

